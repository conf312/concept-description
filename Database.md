## DBMS
데이터베이스 내 데이터에 접근하도록 도와주는 시스템

## 트랜잭션 ACID
데이터베이스의 무결성과 일관성을 위해서 트랜잭션은 4가지 특징을 만족해야하는데요. 원자성은 한 트랜잭션내 실행한 작업은 모두 성공하거나 실패 해야되는거구요. 일관성은 일관성있는 데이터베이스 유지, 격리성은 동시에 실행되는 트랜잭션은 서로 영향을 미치지 않아야 되구요. 지속성은 트랜잭션 완료시 결과가 영구적으로 반영되어야 합니다.

- A: 원자성   
  - 트랜잭션 작업이 부분적으로 실행되거나, 중단되지 않는 것을 보장하는 것

- C: 일관성
  - 일관적인 DB 상태를 유지하는 것

- I: 격리성
  - 트랜잭션 서로를 간섭하지 않는 것

- D: 지속성
  - 성공적으로 수행된 트랜잭션은 영구적으로 반영되는 것  

## 파티셔닝 - MySQL 기준
테이블을 컬럼 단위로 나누어 관리하는 기법

이때, 데이터는 물리적으로 여러 테이블로 분산하여 저장되지만, 사용자는 마치 하나의 테이블에 접근하는 것과 같이 사용할 수 있다는 점이 특징이다. 파티셔닝은 MySQL 단에서 자체적으로 지원하는 기능이다.

MySQL 에서 파티셔닝을 지원하는 스토리지 엔진은 InnoDB와 NDB이며, MyISAM은 파티셔닝을 지원하지 않는다.

![image](https://user-images.githubusercontent.com/13326651/216765531-3db65d96-820c-4558-b2aa-5799186760e6.png)

### List Partitioning
데이터 값이 특정 목록에 포함된 경우 데이터를 분리한다. 위 그림 처럼 특정 지역별로 데이터를 분할할 때 사용할 수 있겠다.

### Range Partitioning
데이터를 특정 범위 기준으로 분할할 때 사용한다. 위 처럼 1~2월, 3~4월, 5~6월 … 으로 데이터를 분리할 때 사용할 수 있다.

### Hash Partitioning
해시 함수를 사용하여 데이터를 분할할 때 사용한다. 특정 컬럼의 값을 해싱하여 저장할 파티션을 선택한다. MySQL 공식 문서에 따르면, 여러 컬럼으로 해싱하는 것은 크게 권장하지 않는다고 한다 (참고).

### Composite Partitioning
위 파티셔닝 종류 중 두개 이상을 사용하는 방식이다.


## 샤딩 - MySQL 기준
데이터 단위로 나누어 분산 저장하는 기법, 작은 단위를 샤드(shard)라고 부른다.

샤딩은 수평 파티셔닝의 일종이다. 차이점은 파티셔닝은 모든 데이터를 동일한 컴퓨터에 저장하지만, 샤딩은 데이터를 서로 다른 컴퓨터에 분산한다는 점이다. 물리적으로 서로 다른 컴퓨터에 데이터를 저장하므로, 쿼리 성능 향상과 더불어 부하가 분산되는 효과까지 얻을 수 있다. 즉, 샤딩은 데이터베이스 차원의 수평 확장(scale-out)인 셈이다.

MongoDB와 같이 데이터베이스 자체에서 샤딩을 제공하는 형태도 있다.

## Hash Sharding
![image](https://user-images.githubusercontent.com/13326651/216766048-e7b8494f-2321-450d-bcbe-935dcbbe927b.png)

Modular Sharding은 PK값의 모듈러 연산 결과를 통해 샤드를 결정하는 방식이다. 총 데이터베이스 수가 정해져있을 때 유용하다. 데이터베이스 개수가 줄어들거나 늘어나면 해시 함수도 변경해야하고, 따라서 데이터의 재 정렬이 필요하다.

## Range Sharding
![image](https://user-images.githubusercontent.com/13326651/216766251-57aa1ada-05af-430a-a8a2-924383b77038.png)

PK 값을 범위로 지정하여 샤드를 지정하는 방식이다. 예를 들어 PK가 1~1,000 까지는 1번 샤드에, 1,001~2,000 까지는 2번 샤드에, 2,001~ 부터는 3번 샤드에 저장할 수 있다. Hash Sharding 대비 데이터베이스 증설 작업에 큰 리소스가 소요되지 않는다. 따라서 급격히 증가할 수 있는 성격의 데이터는 Range Sharding 을 사용함이 좋아보인다. 이런 특징으로 Range Sharding은 Dynamic Sharding 으로도 불린다.

다만, 이렇게 기껏 분산을 시켜놨는데 특정한 데이터베이스에만 부하가 몰릴 수 있다. 예를 들어 페이스북 게시물을 Range Sharding 했다고 가정해보자. 대부분의 트래픽은 최근에 작성한 게시물에서 발생할 것이다. 위 그림에서는 2, 3번 샤드에만 부하가 몰리는 것이다. 부하 분산을 위해 데이터가 몰리는 DB는 다시 재 샤딩(re-sharding)하고, 트래픽이 저조한 데이터베이스는 다시 통합하는 작업이 필요할 것이다.











