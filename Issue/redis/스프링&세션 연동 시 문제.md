### 문제점
- Key TTL이 만료되었어도 일부 데이터 `spring:session:index:FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAME:$username` 의 쓰레기 값이 계속 쌓인다. 
- 결국 Redis 공간이 가득차서 `OOM Exception` 발생
- 서비스 장애로 발생되어 결국 서비스가 정지되며, 레디스 key를 비워주지 않으면 어플리케이션은 정상동작 안됨 (반복)

### 예시 데이터
```
1) "spring:session:expirations:1699920780000"
2) "spring:session:sessions:expires:1522b7ae-cf56-40d5-8839-22899371b509"
3) "spring:session:sessions:1522b7ae-cf56-40d5-8839-22899371b501"
4) "spring:session:index:org.springframework.session.FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAME:3194660"
```

### @EnableRedisHttpSession 
스프링 레디스 연동 시 사용하는 어노테이션으로 AutoConfiguration으로 `RedisIndexedSessionRepository` 을 생성하여 사용한다.
`RedisIndexedSessionRepository`은 `spring:session:index:FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAME:$username` 을 생성한다.

### 해결 방법
Spring Boot에서 Redis를 사용하여 세션을 저장할 때 세션이 만료될 때 일어나는 이벤트를 처리하려면 `SessionDestroyedEvent`를 사용할 수 있다. 
`SessionDestroyedEvent`는 Spring Session이 세션 만료를 감지했을 때 발생하는 이벤트이다.

### SessionDestroyedEvent를 처리하는 간단한 예제
```java
import org.springframework.context.ApplicationListener;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.session.Session;
import org.springframework.session.events.SessionDestroyedEvent;

public class SessionExpiredListener implements ApplicationListener<SessionDestroyedEvent> {

    @Override
    public void onApplicationEvent(SessionDestroyedEvent event) {
        for (Session session : event.getSecuritySessions()) {
            // 만료된 세션에 대한 처리 로직을 추가
            String sessionId = session.getId();
            System.out.println("Session expired: " + sessionId);

            // 여기에서 Redis 또는 다른 저장소에서 해당 세션 데이터를 삭제할 수 있다.
        }

        // 만료된 세션에 대한 추가적인 로직을 수행할 수도 있다.
    }
}
```
위의 코드에서 `SessionDestroyedEvent`를 처리하는 리스너 클래스 `SessionExpiredListener`를 정의하였습니다. `onApplicationEvent` 메서드에서 만료된 세션에 대한 로직을 추가할 수 있다.

이 리스너를 스프링 빈으로 등록하려면 다음과 같이 설정한다.
```java
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class AppConfig {

    @Bean
    public SessionExpiredListener sessionExpiredListener() {
        return new SessionExpiredListener();
    }
}
```
위의 예제에서는 만료된 세션에 대한 처리 로직으로 세션 ID를 출력하고 있다. 여기에서 실제로 세션 데이터를 Redis에서 삭제하거나 추가적인 로직을 수행하면 된다.
