## 시스템 설계의 기본
### 웹 서버, 데이터베이스 분산 (마스터(쓰기), 슬레이브(읽기))
### 캐시 (웹 서버 ← 캐시 ← 데이터베이스)

### 콘텐츠 전송 네트워크 (CDN)
클라이언트가 접속하는 가장 가까운 `CDN 서버`가 콘텐츠를 전달하게 되는 방식

1. CDN 서버에 콘텐츠가 없다면 원본 서버로 부터 가져온다. 그 콘텐츠를 CDN 서버에 저장한다. URL 도메인은 CDN 사업자가 제공한다.
ex) 클라우드 프론트 `https://site.cloudfront.net/logo.png` 아카마이 `https://site.akamai.com/image-manager/img/logo.png`

2. CDN 서버의 캐시에 해당 이미지가 없는 경우 서버는 원본(Origin) 서버에 요청하여 파일을 가져온다. 원본 서버는 웹 서버 일 수도, 아마존 S3와 같은 온라인 저장소일 수도 있다.
3. 원본 서버가 파일을 CDN 서버에 반환한다. 응답 HTTP 헤더에는 캐시 기간을 설명하는 `TTL(Time-To-Live)` 값이 들어 있다.
4. CDN 서버는 파일을 캐시하고 사용자 A에게 반환한다. 이미지는 TTL에 명시된 시간이 끝날 때까지 캐시된다.
5. 사용자가 B가 같은 이미지에 대한 요청을 CDN 서버에 요청한다.
6. 만료되지 않은 이미지에 대한 요청은 캐시를 통해 처리된다.

❗️ CDN 사용 시 고려 사항
- 비용: CDN은 보통 제3 사업자에 의해 운영되며, 데이터 전송 양에 따라 요금을 내게 된다. 자주 사용되지 않는 콘텐츠를 캐싱하는 것은 비효율적이다.
- 적절한 만료시간: 너무 길지도 짧지도 않아야 하는데, 길면 콘텐츠의 신선도는 떨어질 것이고, 짧으면 원본 서버에 접속하는 일이 자주 발생하니 비즈니스에 맞게 조절한다.
- CDN 장애 대처 방안: CDN 서버의 장애를 대비하여 원본 서버에서도 가져 올 수 있도록 구성하는 것이 필요할 수도 있다.
- 콘텐츠 무효화: 아직 만료되지 않은 콘텐츠라 하더라도 이미지 변경이나, 수정이 일어 날 수 있다. 이 경우 CDN 서비스 사업자가 제공하는 API를 이용하여 콘텐츠 무효화 한다. 또는 새로운 버전을 지정하기 위해서는 URL 마지막에 버전 번호를 인자로 주면 된다. `image.png?v=2` 와 같은 식이다.

